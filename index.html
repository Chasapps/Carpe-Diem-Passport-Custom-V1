<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Carpe Diem Passport — Splash</title>

  <!-- iOS fullscreen / theme setup -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0C2231">

  <link rel="stylesheet" href="style.css">
</head>
<body class="splash-body" id="splashBody">
  <div class="splash-overlay">
    <div id="nameTip" class="name-tip">✨ Tap to personalize</div>
    <h1 id="ownerName" class="foil-emboss owner-name">Tonia Norton</h1>
  </div>

  <div id="resetIcon">↻</div>

  <div id="confirmBox">
    <p>Reset name?</p>
    <button id="btnYes">Yes</button>
    <button id="btnNo">No</button>
  </div>

  <script>
  (function(){
    const KEY  = 'passport_owner_name';
    const LOCK = 'passport_owner_name_locked';

    const owner = document.getElementById('ownerName');
    const body  = document.getElementById('splashBody');
    const tip   = document.getElementById('nameTip');
    const reset = document.getElementById('resetIcon');
    const box   = document.getElementById('confirmBox');
    const yes   = document.getElementById('btnYes');
    const no    = document.getElementById('btnNo');

    const saved  = localStorage.getItem(KEY);
    const locked = localStorage.getItem(LOCK) === '1';

    if (saved) owner.textContent = saved;

    // First-time tooltip
    if (!saved) {
      requestAnimationFrame(() => tip.classList.add('show'));
      setTimeout(() => tip.classList.remove('show'), 3000);
    } else if (tip && tip.parentNode) {
      tip.remove();
    }

    function applyFoil(el){
      el.classList.add('foil-emboss','owner-name');
    }
    applyFoil(owner);

    // Enter app when tapping anywhere else
    body.addEventListener('click', () => {
      try { sessionStorage.setItem('enteredViaSplash','1'); } catch(e) {}
      window.location.href = 'app.html';
    });

    // Stop navigation for interactive elements
    [owner, reset, box, yes, no].forEach(el => {
      if (!el) return;
      el.addEventListener('click', ev => ev.stopPropagation());
    });

    // One-time editable name
    owner.addEventListener('click', e => {
      e.stopPropagation();
      if (localStorage.getItem(LOCK) === '1') return;

      const prev = owner.textContent.trim();
      const input = document.createElement('input');
      input.type = 'text';
      input.value = prev || 'Your Name';
      input.setAttribute('maxlength','40');
      input.className = 'owner-input';
      input.addEventListener('click', ev => ev.stopPropagation());

      owner.replaceWith(input);
      input.focus();
      input.select();

      function finish() {
        let v = input.value.trim() || prev || 'Your Name';
        try {
          localStorage.setItem(KEY, v);
          localStorage.setItem(LOCK, '1');
        } catch(e) {}

        const h = document.createElement('h1');
        h.id = 'ownerName';
        h.textContent = v;
        applyFoil(h);
        h.style.pointerEvents = 'none';
        input.replaceWith(h);
      }

      input.addEventListener('keydown', ev => {
        if (ev.key === 'Enter') {
          ev.preventDefault();
          finish();
        }
      });

      input.addEventListener('blur', finish);
    });

    // Long-press (mouse + touch) to reveal reset icon
    let pressTimer;
    const showReset   = () => { reset.classList.add('show'); };
    const startPress  = () => { clearTimeout(pressTimer); pressTimer = setTimeout(showReset, 1500); };
    const cancelPress = () => { clearTimeout(pressTimer); };

    owner.addEventListener('mousedown', startPress);
    owner.addEventListener('mouseup',   cancelPress);
    owner.addEventListener('mouseleave',cancelPress);

    owner.addEventListener('touchstart', startPress, { passive:true });
    owner.addEventListener('touchend',   cancelPress);
    owner.addEventListener('touchcancel',cancelPress);

    // Reset flow
    reset.addEventListener('click', e => {
      e.stopPropagation();
      box.classList.add('show');
    });

    yes.addEventListener('click', e => {
      e.stopPropagation();
      localStorage.removeItem(KEY);
      localStorage.removeItem(LOCK);
      box.classList.remove('show');
      reset.classList.remove('show');
      owner.textContent = 'Tonia Norton';
      applyFoil(owner);
      tip.classList.add('show');
      setTimeout(() => tip.classList.remove('show'), 3000);
    });

    no.addEventListener('click', e => {
      e.stopPropagation();
      box.classList.remove('show');
    });

    // Hide reset icon automatically after a short delay if user taps elsewhere
    body.addEventListener('click', () => {
      setTimeout(() => reset.classList.remove('show'), 3000);
    });
  })();
  </script>
</body>
</html>
